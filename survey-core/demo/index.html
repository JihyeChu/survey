<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurveyCore Demo</title>
    <link rel="stylesheet" href="../src/survey.css">
    <style>
        /* Demo Page Specific Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        .demo-header {
            background-color: #fff;
            border-bottom: 1px solid #dadce0;
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3);
        }

        .demo-header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .demo-title {
            font-size: 20px;
            font-weight: 500;
            color: #202124;
        }

        .demo-version {
            font-size: 12px;
            color: #5f6368;
            margin-left: 8px;
        }

        .demo-tabs {
            display: flex;
            gap: 8px;
        }

        .demo-tab {
            padding: 10px 20px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background-color: #fff;
            color: #5f6368;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-tab:hover {
            background-color: rgba(255, 107, 0, 0.08);
            border-color: #FF6B00;
        }

        .demo-tab.active {
            background-color: #FF6B00;
            color: #fff;
            border-color: #FF6B00;
        }

        .demo-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .demo-view {
            display: none;
        }

        .demo-view.active {
            display: block;
        }

        /* Builder Demo */
        #builder-root {
            min-height: 400px;
        }

        /* Responder Demo */
        #responder-root {
            min-height: 400px;
        }

        /* Console Panel */
        .demo-console {
            margin-top: 24px;
            background-color: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
        }

        .demo-console-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background-color: #2d2d2d;
            border-bottom: 1px solid #3e3e3e;
        }

        .demo-console-title {
            font-size: 14px;
            font-weight: 500;
            color: #e0e0e0;
        }

        .demo-console-clear {
            padding: 6px 12px;
            background-color: transparent;
            border: 1px solid #5f6368;
            border-radius: 4px;
            color: #9aa0a6;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-console-clear:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #9aa0a6;
        }

        .demo-console-output {
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .demo-console-output:empty::before {
            content: '// Console output will appear here...';
            color: #6a6a6a;
        }

        .demo-log {
            padding: 4px 0;
            border-bottom: 1px solid #2d2d2d;
        }

        .demo-log:last-child {
            border-bottom: none;
        }

        .demo-log-time {
            color: #6a6a6a;
            margin-right: 8px;
        }

        .demo-log-type {
            font-weight: 500;
            margin-right: 8px;
        }

        .demo-log-type.info {
            color: #4fc3f7;
        }

        .demo-log-type.success {
            color: #81c784;
        }

        .demo-log-type.warning {
            color: #ffb74d;
        }

        .demo-log-type.error {
            color: #e57373;
        }

        .demo-log-message {
            color: #e0e0e0;
        }

        .demo-log-data {
            color: #9aa0a6;
            margin-top: 4px;
            padding-left: 16px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Info Panel */
        .demo-info {
            margin-bottom: 24px;
            padding: 16px;
            background-color: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .demo-info h3 {
            font-size: 14px;
            font-weight: 500;
            color: #1565c0;
            margin-bottom: 8px;
        }

        .demo-info p {
            font-size: 13px;
            color: #37474f;
            line-height: 1.6;
            margin: 0;
        }

        /* Actions */
        .demo-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .demo-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-btn-primary {
            background-color: #FF6B00;
            color: #fff;
        }

        .demo-btn-primary:hover {
            background-color: #E55F00;
        }

        .demo-btn-secondary {
            background-color: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
        }

        .demo-btn-secondary:hover {
            background-color: rgba(255, 107, 0, 0.08);
        }
    </style>
</head>
<body>
    <header class="demo-header">
        <div class="demo-header-content">
            <div>
                <span class="demo-title">SurveyCore Demo</span>
                <span class="demo-version" id="version-display">v1.0.0</span>
            </div>
            <div class="demo-tabs">
                <button class="demo-tab active" data-view="builder">Builder</button>
                <button class="demo-tab" data-view="responder">Responder</button>
            </div>
        </div>
    </header>

    <main class="demo-main">
        <!-- Builder View -->
        <div id="view-builder" class="demo-view active">
            <div class="demo-info">
                <h3>Builder Mode</h3>
                <p>
                    설문 폼을 생성하고 편집합니다. 질문을 추가, 수정, 삭제하고 드래그로 순서를 변경할 수 있습니다.
                    모든 변경사항은 콜백을 통해 전달되며, 콘솔에서 확인할 수 있습니다.
                </p>
            </div>

            <div class="demo-actions">
                <button class="demo-btn demo-btn-primary" id="btn-add-question">질문 추가</button>
                <button class="demo-btn demo-btn-secondary" id="btn-get-form">폼 데이터 가져오기</button>
                <button class="demo-btn demo-btn-secondary" id="btn-load-sample">샘플 데이터 로드</button>
                <button class="demo-btn demo-btn-secondary" id="btn-export-json">JSON 내보내기</button>
            </div>

            <div id="builder-root"></div>

            <div class="demo-console">
                <div class="demo-console-header">
                    <span class="demo-console-title">Builder Console</span>
                    <button class="demo-console-clear" id="clear-builder-console">Clear</button>
                </div>
                <div class="demo-console-output" id="builder-console"></div>
            </div>
        </div>

        <!-- Responder View -->
        <div id="view-responder" class="demo-view">
            <div class="demo-info">
                <h3>Responder Mode</h3>
                <p>
                    생성된 설문에 응답합니다. Builder에서 작성한 폼을 기반으로 응답 화면이 렌더링됩니다.
                    응답 제출 시 콜백으로 데이터가 전달되며, 콘솔에서 확인할 수 있습니다.
                </p>
            </div>

            <div class="demo-actions">
                <button class="demo-btn demo-btn-primary" id="btn-sync-form">Builder 폼 동기화</button>
                <button class="demo-btn demo-btn-secondary" id="btn-get-response">현재 응답 가져오기</button>
                <button class="demo-btn demo-btn-secondary" id="btn-validate-response">응답 검증</button>
                <button class="demo-btn demo-btn-secondary" id="btn-reset-response">응답 초기화</button>
            </div>

            <div id="responder-root"></div>

            <div class="demo-console">
                <div class="demo-console-header">
                    <span class="demo-console-title">Responder Console</span>
                    <button class="demo-console-clear" id="clear-responder-console">Clear</button>
                </div>
                <div class="demo-console-output" id="responder-console"></div>
            </div>
        </div>
    </main>

    <script src="../src/survey-core.js"></script>
    <script>
        (function() {
            'use strict';

            // ========================================================
            // SAMPLE FORM DATA
            // ========================================================
            const sampleForm = {
                id: 'sample-form-001',
                title: '고객 만족도 조사',
                description: '저희 서비스에 대한 소중한 의견을 남겨주세요. 응답해 주신 내용은 서비스 개선에 활용됩니다.',
                questions: [
                    {
                        id: 'q1',
                        type: 'short-text',
                        title: '성함을 입력해주세요',
                        description: '',
                        required: true,
                        orderIndex: 0,
                        config: {}
                    },
                    {
                        id: 'q2',
                        type: 'multiple-choice',
                        title: '서비스를 어떻게 알게 되셨나요?',
                        description: '가장 주요한 경로를 선택해주세요.',
                        required: true,
                        orderIndex: 1,
                        config: {
                            options: [
                                { id: 'opt1', label: '검색 엔진 (Google, Naver 등)', order: 0 },
                                { id: 'opt2', label: 'SNS (Instagram, Facebook 등)', order: 1 },
                                { id: 'opt3', label: '지인 추천', order: 2 },
                                { id: 'opt4', label: '온라인 광고', order: 3 },
                                { id: 'opt5', label: '기타', order: 4 }
                            ]
                        }
                    },
                    {
                        id: 'q3',
                        type: 'checkbox',
                        title: '관심있는 서비스를 모두 선택해주세요',
                        description: '여러 개 선택 가능합니다.',
                        required: false,
                        orderIndex: 2,
                        config: {
                            options: [
                                { id: 'cb1', label: '웹 개발', order: 0 },
                                { id: 'cb2', label: '모바일 앱 개발', order: 1 },
                                { id: 'cb3', label: 'UI/UX 디자인', order: 2 },
                                { id: 'cb4', label: '클라우드 인프라', order: 3 },
                                { id: 'cb5', label: '데이터 분석', order: 4 }
                            ]
                        }
                    },
                    {
                        id: 'q4',
                        type: 'linear-scale',
                        title: '전반적인 서비스 만족도는 어느 정도인가요?',
                        description: '',
                        required: true,
                        orderIndex: 3,
                        config: {
                            min: 1,
                            max: 5,
                            minLabel: '매우 불만족',
                            maxLabel: '매우 만족'
                        }
                    },
                    {
                        id: 'q5',
                        type: 'dropdown',
                        title: '이용 기간을 선택해주세요',
                        description: '',
                        required: false,
                        orderIndex: 4,
                        config: {
                            options: [
                                { id: 'dur1', label: '1개월 미만', order: 0 },
                                { id: 'dur2', label: '1-3개월', order: 1 },
                                { id: 'dur3', label: '3-6개월', order: 2 },
                                { id: 'dur4', label: '6개월-1년', order: 3 },
                                { id: 'dur5', label: '1년 이상', order: 4 }
                            ]
                        }
                    },
                    {
                        id: 'q6',
                        type: 'date',
                        title: '가입일을 선택해주세요',
                        description: '',
                        required: false,
                        orderIndex: 5,
                        config: {}
                    },
                    {
                        id: 'q7',
                        type: 'long-text',
                        title: '서비스 개선을 위한 의견을 자유롭게 작성해주세요',
                        description: '불편했던 점이나 추가되었으면 하는 기능 등을 알려주세요.',
                        required: false,
                        orderIndex: 6,
                        config: {}
                    }
                ],
                settings: {
                    collectEmail: true,
                    allowResponseEdit: false,
                    showProgressBar: true
                },
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // ========================================================
            // CONSOLE LOGGING
            // ========================================================
            function logToConsole(consoleId, type, message, data) {
                const consoleEl = document.getElementById(consoleId);
                if (!consoleEl) return;

                const time = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'demo-log';

                let dataHtml = '';
                if (data !== undefined) {
                    try {
                        const dataStr = JSON.stringify(data, null, 2);
                        if (dataStr.length > 500) {
                            dataHtml = `<div class="demo-log-data">${dataStr.substring(0, 500)}...</div>`;
                        } else {
                            dataHtml = `<div class="demo-log-data">${dataStr}</div>`;
                        }
                    } catch (e) {
                        dataHtml = `<div class="demo-log-data">[Object]</div>`;
                    }
                }

                logEntry.innerHTML = `
                    <span class="demo-log-time">[${time}]</span>
                    <span class="demo-log-type ${type}">${type.toUpperCase()}</span>
                    <span class="demo-log-message">${message}</span>
                    ${dataHtml}
                `;

                consoleEl.appendChild(logEntry);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }

            // ========================================================
            // BUILDER INSTANCE
            // ========================================================
            let builderInstance = null;

            function initBuilderDemo() {
                builderInstance = SurveyCore.initBuilder('#builder-root', {
                    form: SurveyCore.createDefaultForm(),
                    onChange: (form) => {
                        logToConsole('builder-console', 'info', 'Form changed', form);
                    },
                    onQuestionAdd: (question, index) => {
                        logToConsole('builder-console', 'success', `Question added at index ${index}`, question);
                    },
                    onQuestionRemove: (question, index) => {
                        logToConsole('builder-console', 'warning', `Question removed from index ${index}`, question);
                    },
                    onQuestionUpdate: (question) => {
                        logToConsole('builder-console', 'info', 'Question updated', question);
                    },
                    onSave: (form) => {
                        logToConsole('builder-console', 'success', 'Form auto-saved', { id: form.id, questionCount: form.questions.length });
                    }
                });

                logToConsole('builder-console', 'info', 'Builder initialized', { version: SurveyCore.version });
            }

            // ========================================================
            // RESPONDER INSTANCE
            // ========================================================
            let responderInstance = null;

            function initResponderDemo() {
                const form = builderInstance ? builderInstance.getForm() : sampleForm;

                responderInstance = SurveyCore.initResponder('#responder-root', {
                    form: form,
                    onChange: (response) => {
                        logToConsole('responder-console', 'info', 'Response changed', response.answers);
                    },
                    onSubmit: async (response) => {
                        logToConsole('responder-console', 'success', 'Response submitted!', response);

                        // Simulate async submission
                        return new Promise((resolve) => {
                            setTimeout(() => {
                                alert('응답이 제출되었습니다! (데모 - 실제 저장되지 않음)');
                                resolve();
                            }, 1000);
                        });
                    },
                    onValidationError: (result) => {
                        logToConsole('responder-console', 'error', 'Validation failed', result);
                    },
                    onFileUpload: async (questionId, files) => {
                        logToConsole('responder-console', 'info', `File upload requested for question ${questionId}`, {
                            fileCount: files.length,
                            files: files.map(f => ({ name: f.name, size: f.size }))
                        });

                        // Simulate file upload
                        return files.map(f => ({
                            filename: f.name,
                            storedName: `uploaded-${Date.now()}-${f.name}`,
                            size: f.size
                        }));
                    }
                });

                logToConsole('responder-console', 'info', 'Responder initialized', {
                    version: SurveyCore.version,
                    formTitle: form.title,
                    questionCount: form.questions.length
                });
            }

            // ========================================================
            // TAB NAVIGATION
            // ========================================================
            function setupTabs() {
                document.querySelectorAll('.demo-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const view = tab.dataset.view;

                        // Update tabs
                        document.querySelectorAll('.demo-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');

                        // Update views
                        document.querySelectorAll('.demo-view').forEach(v => v.classList.remove('active'));
                        document.getElementById(`view-${view}`).classList.add('active');

                        // Initialize responder if switching to it
                        if (view === 'responder' && !responderInstance) {
                            initResponderDemo();
                        }
                    });
                });
            }

            // ========================================================
            // BUTTON ACTIONS
            // ========================================================
            function setupActions() {
                // Builder actions
                document.getElementById('btn-add-question').addEventListener('click', () => {
                    if (builderInstance) {
                        builderInstance.addQuestion('short-text');
                    }
                });

                document.getElementById('btn-get-form').addEventListener('click', () => {
                    if (builderInstance) {
                        const form = builderInstance.getForm();
                        logToConsole('builder-console', 'info', 'Current form data', form);
                        console.log('Form Data:', form);
                    }
                });

                document.getElementById('btn-load-sample').addEventListener('click', () => {
                    if (builderInstance) {
                        builderInstance.setForm(sampleForm);
                        logToConsole('builder-console', 'success', 'Sample form loaded', {
                            title: sampleForm.title,
                            questionCount: sampleForm.questions.length
                        });
                    }
                });

                document.getElementById('btn-export-json').addEventListener('click', () => {
                    if (builderInstance) {
                        const form = builderInstance.getForm();
                        const json = JSON.stringify(form, null, 2);
                        const blob = new Blob([json], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `form-${form.id}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                        logToConsole('builder-console', 'success', 'JSON exported', { filename: `form-${form.id}.json` });
                    }
                });

                // Responder actions
                document.getElementById('btn-sync-form').addEventListener('click', () => {
                    if (builderInstance && responderInstance) {
                        const form = builderInstance.getForm();
                        responderInstance.setForm(form);
                        logToConsole('responder-console', 'success', 'Form synced from Builder', {
                            title: form.title,
                            questionCount: form.questions.length
                        });
                    }
                });

                document.getElementById('btn-get-response').addEventListener('click', () => {
                    if (responderInstance) {
                        const response = responderInstance.getResponse();
                        logToConsole('responder-console', 'info', 'Current response data', response);
                        console.log('Response Data:', response);
                    }
                });

                document.getElementById('btn-validate-response').addEventListener('click', () => {
                    if (responderInstance) {
                        const result = responderInstance.validate();
                        logToConsole('responder-console', result.valid ? 'success' : 'error',
                            result.valid ? 'Validation passed!' : 'Validation failed',
                            result);
                    }
                });

                document.getElementById('btn-reset-response').addEventListener('click', () => {
                    if (responderInstance) {
                        const form = responderInstance.getForm();
                        const emptyResponse = SurveyCore.createEmptyResponse(form);
                        responderInstance.setResponse(emptyResponse);
                        logToConsole('responder-console', 'info', 'Response reset', emptyResponse);
                    }
                });

                // Console clear buttons
                document.getElementById('clear-builder-console').addEventListener('click', () => {
                    document.getElementById('builder-console').innerHTML = '';
                });

                document.getElementById('clear-responder-console').addEventListener('click', () => {
                    document.getElementById('responder-console').innerHTML = '';
                });
            }

            // ========================================================
            // INITIALIZATION
            // ========================================================
            function init() {
                // Display version
                document.getElementById('version-display').textContent = `v${SurveyCore.version}`;

                // Setup
                setupTabs();
                setupActions();

                // Initialize builder
                initBuilderDemo();

                console.log('SurveyCore Demo initialized');
                console.log('Available APIs:', Object.keys(SurveyCore));
            }

            // Start when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>
